import{d as S,n as x,p as B,q as E,E as u,m as c,s as V,c as N,b as t,w as l,h as i,o as P,u as m,x as R,y as $,z as M,a as q,e as _,A as z,g as A,_ as K}from"./index-9892e16c.js";import{g as T,a as j,l as D}from"./user-96c5e5f5.js";import"./axios-8a97e361.js";const G={class:"index"},H=["src"],J=S({__name:"Login",setup(O){const b=D,f=o=>{o.key==="Enter"&&(x(o),w(n))};x(()=>{document.addEventListener("keyup",f),v()}),B(()=>{document.removeEventListener("keyup",f)});const g=E(""),v=()=>{T(null).then(o=>{o.code===8291?(localStorage.setItem("code-uuid",o.data.uuid),g.value="data:image/png;base64,"+o.data.img):u({title:"Error",message:c("i",{style:"color: red"},"获取验证码失败")})}).catch(o=>{u({title:"Error",message:c("i",{style:"color: teal"},"服务器响应失败")})})},k=A(),n=E(),a=V({username:"",password:"",code:""}),U=V({username:[{validator:(o,e,s)=>{if(e==="")s(new Error("请输入用户名"));else{if(a.password!==""){if(!n.value)return;n.value.validateField("validatePassword",()=>null)}s()}},trigger:"blur"}],password:[{validator:(o,e,s)=>{if(e==="")s(new Error("请输入密码"));else{if(a.password!==""){if(!n.value)return;n.value.validateField("validatePassword",()=>null)}s()}},trigger:"blur"}]}),w=o=>{const e=localStorage.getItem("code-uuid");localStorage.removeItem("code-uuid"),o&&o.validate(s=>{s?j({username:a.username,password:a.password,code:a.code,uuid:e}).then(r=>{r.code===500?u({title:"Error",message:c("i",{style:"color: teal"},r.message)}):r.code===8291?(sessionStorage.setItem("user-token",r.data),k.push("/index")):u({title:"Error",message:c("i",{style:"color: teal"},"服务器内部异常")})}).catch(r=>{u({title:"Error",message:c("i",{style:"color: teal"},"用户登录失败！")})}):u({title:"Error",message:c("i",{style:"color: teal"},"服务器响应失败！")})})},h=o=>{o&&o.resetFields()};return(o,e)=>{const s=i("el-image"),r=i("el-input"),p=i("el-form-item"),C=i("el-icon"),F=i("el-tooltip"),y=i("el-button"),I=i("el-form"),L=i("el-card");return P(),N("div",G,[t(L,{shadow:"hover",class:"login"},{default:l(()=>[t(s,{src:m(b),alt:"logo",width:"40%"},null,8,["src"]),t(I,{ref_key:"ruleFormRef",ref:n,model:a,"status-icon":"",rules:U},{default:l(()=>[t(p,{prop:"username"},{default:l(()=>[t(r,{clearable:"","prefix-icon":m(R),placeholder:"用户名",modelValue:a.username,"onUpdate:modelValue":e[0]||(e[0]=d=>a.username=d),type:"text",autocomplete:"off"},null,8,["prefix-icon","modelValue"])]),_:1}),t(p,{prop:"password"},{default:l(()=>[t(r,{clearable:"","prefix-icon":m($),placeholder:"用户密码",modelValue:a.password,"onUpdate:modelValue":e[1]||(e[1]=d=>a.password=d),type:"password","show-password":"",autocomplete:"off"},null,8,["prefix-icon","modelValue"])]),_:1}),t(p,{prop:"code",type:"text"},{default:l(()=>[t(r,{clearable:"","prefix-icon":m(M),placeholder:"验证码",modelValue:a.code,"onUpdate:modelValue":e[3]||(e[3]=d=>a.code=d),modelModifiers:{number:!0}},{append:l(()=>[q("img",{src:g.value},null,8,H),_("    "),t(F,{effect:"dark",content:"点击刷新验证码",placement:"bottom"},{default:l(()=>[t(C,{onClick:e[2]||(e[2]=d=>v())},{default:l(()=>[t(m(z))]),_:1})]),_:1})]),_:1},8,["prefix-icon","modelValue"])]),_:1}),t(p,{class:"function_btn"},{default:l(()=>[t(y,{type:"primary",onClick:e[4]||(e[4]=d=>w(n.value))},{default:l(()=>[_("登录")]),_:1}),t(y,{onClick:e[5]||(e[5]=d=>h(n.value))},{default:l(()=>[_("重置")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})])}}});const ee=K(J,[["__scopeId","data-v-aa652a29"]]);export{ee as default};
